# Table of Contents
1. [setup and installation](#setup-and-installation)
   1. [python](#python)
   2. [c++](#c++)
2. [data and configuration](#data-and-configuration)
   1. [cntl file](#cntl-file)
   2. [tsv files](#tsv-files)
      1. [db index](#db-index)
      2. [results](#results)
   3. [ok](#ok)
3. [all in one bash script](#all-in-one-bash-script)
4. [running parts individually](#running-parts-individually)
   1. [indexing](#indexing)
   2. [querying](#querying)
   3. [testing](#testing)
   4. [example](#example)


## setup and installation
tested on linux
### python
(optional) install anaconda distribution https://www.anaconda.com/products/individual
```zsh
$ conda create -n tangent-s python=3.6.9
$ conda activate tangent-s
$ cd /path/to/tangent-s 
$ pip install -r requirements.txt
$ export PYTHONPATH=$PYTHONPATH:/full/path/to/tangent-s/
```

standalone python
```zsh
$ cd /path/to/tangent-s 
$ pip install -r requirements.txt
```

### c++
Build c++ indexing tool
```zsh
$ cd /path/to/tangent-s/
$ cd src/cpp/
$ make install
```
Take not that a mathindex.exe appears in the ``src/cpp/`` directory
## data and configuration
### cntl file
an example cntl file is shown below. explanations for each field can be found below that.
```shell
cntl	arqopt.cntl
window	4
queries	../testing/test_queries/opt_task1_mod.xml
doc_list	../cntl/testlist.txt
database	dbarqmathopt-new
chunk_size	200
tree_model	operator
file_skips	[0]
index_fileids	{3530}
query_fileids	{23618}
```
explanations: 

`cntl` the name of the control file  
`window` The window that is applied during 
the spectral graph search process  
`queries` relative path to the xml file 
containing the queries that should be run against the indexes  
`doc_list`
### tsv-files
#### index
An example index file (generated by index.py) is found below 
followed by explanations for each row
<details>
<summary>db-index/[db-name]_i_*.tsv</summary>

```
W	4
O	1

D	1000
E	[U!times,0[T!\\mathbb],1[O!SUB,0[V!ğ¹],1[V!ğ‘]]]	[0]

D	1001
E	[O!notin,0[V!ğ‘–],1[V!ğ‘š]]	[0]

D	1002
E	[V!ğ‘£]	[0]

D	1003
E	[O!leq,0[V!ğº],1[U!times,0[T!\\mathfrak],1[O!SUB,0[V!ğ‘†],1[V!ğº]]]]	[0]

D	1005
E	[U!eq,0[O!SUP,0[O!SUP,0[O!SUB,0[V!ğ´],1[O!minus,0[V!ğ‘],1[N!1]]],1[V!ğ‘’]],1[V!ğ‘¦]],1[U!union,0[U!intersect,0[O!SUB,0[O!SUP,0[V!ğ´],1[V!ğ‘’]],1[V!ğ‘]],1[V!ğ‘‡]],1[O!minus,0[O!SUB,0[O!SUP,0[V!ğ´],1[O!minus,0[V!ğ‘’],1[N!1]]],1[V!ğ‘]],1[V!ğ‘‡]]]]	[0]
```

</details>

`W` the window size  
`O` TODO

`D` DocId  
`E` 
#### query
An example query file (generated by query.py) is found below 
followed by explanations for each row
the name is 
<details>
<summary>example db-index/[database]_q_*.tsv</summary>

```
K	1000
W	4
O	0

Q	A.1
E	[V!f[M!()1x1[=[O!divide,o[V!x[+[V!x[+[V!c]]]],a[N!2]],u[V!x[+[N!2[V!x[+[V!c]]]]],a[N!2]]]],w[V!x]]]	[0]

Q	A.2
E	[V!f[M!()1x1[=[V!f[M!()1x1,w[V!x[+[N!1]]]]]],w[V!x]],a[â€²]]	[0]

Q	A.3
E	[O!root,w[N!5]]	[0]

...
```
</details>

`K` Indicates that the top K results will be found for each query  
`W` the window size  
`O` todo

`Q` query id  
`E` formula

#### 1st results

These are the initial K top results found for each query using the 
c++ built mathindex tool.

<details>
<summary>example results/[cntl]_results.tsv</summary>

```
I	it	77728.3
I	it	49447.7
I	it	68733
I	it	67039.8
I	it	65412.9
I	it	46666.1
I	it	47961.3
I	it	47491
I	it	80854.5
I	it	55637.2

Q	B.1
E	[U!eq,0[U!times,0[V!ğ‘“],1[V!ğ‘¥]],1[O!divide,0[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[V!ğ‘¥],2[V!ğ‘]],1[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[N!2],1[V!ğ‘¥]],2[V!ğ‘]]]]
R	15658584	0	[O!form-seq,0[U!eq,0[U!times,0[V!ğ‘“],1[V!ğ‘¥]],1[O!divide,0[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[V!ğ‘¥],2[V!ğ‘]],1[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[N!2],1[V!ğ‘¥]],2[V!ğ‘]]]],1[O!in,0[V!ğ‘¥],1[U!times,0[T!\\mathbb],1[V!ğ‘…]]]]	0.8125
R	11639119	0	[U!eq,0[U!times,0[V!ğ‘”],1[U!times,0[V!ğ‘“],1[V!ğ‘¥]]],1[O!divide,0[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[V!ğ‘¥],2[N!1]],1[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[N!2],1[V!ğ‘¥]],2[N!1]]]]	0.8
R	11657033	0	[U!eq,0[U!times,0[V!ğ‘”],1[U!times,0[V!ğ‘“],1[V!ğ‘¥]]],1[O!divide,0[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[V!ğ‘¥],2[N!1]],1[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[N!2],1[V!ğ‘¥]],2[N!1]]]]	0.8
R	23659576	0	[U!eq,0[U!times,0[V!ğ‘“],1[V!ğ‘¥]],1[O!divide,0[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[N!2],1[V!ğ‘¥]]],1[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[N!2],1[V!ğ‘¥]],2[N!2]]]]	0.788991
R	18854663	0	[U!eq,0[U!times,0[V!ğ‘“],1[V!ğ‘¥]],1[O!divide,0[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[V!ğ‘],1[V!ğ‘¥]],2[V!ğ‘]],1[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[N!2],1[V!ğ‘¥]],2[N!3]]]]	0.767857
R	3726843	0	[U!eq,0[U!times,0[V!ğ‘“],1[V!ğ‘¥]],1[O!divide,0[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[V!ğ‘],1[V!ğ‘¥]],2[V!ğ‘]],1[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[N!2],1[V!ğ‘¥]],2[N!3]]]]	0.767857
...
```

</details>

`I` indexing time  

`Q` query id  
`E` the Formula  
`R` a tuple defined as such (DocId, Score, Formula, retrieval time)


#### reranking results
<details>
<summary>example results/[cntl]_results.tsv</summary>

```
Q	B.1
E	[U!eq,0[U!times,0[V!ğ‘“],1[V!ğ‘¥]],1[O!divide,0[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[V!ğ‘¥],2[V!ğ‘]],1[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[N!2],1[V!ğ‘¥]],2[V!ğ‘]]]]
R	15658584	0	[O!form-seq,0[U!eq,0[U!times,0[V!ğ‘“],1[V!ğ‘¥]],1[O!divide,0[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[V!ğ‘¥],2[V!ğ‘]],1[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[N!2],1[V!ğ‘¥]],2[V!ğ‘]]]],1[O!in,0[V!ğ‘¥],1[U!times,0[T!\\mathbb],1[V!ğ‘…]]]]	[1.0,0.76,1.0]
R	23659576	0	[U!eq,0[U!times,0[V!ğ‘“],1[V!ğ‘¥]],1[O!divide,0[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[N!2],1[V!ğ‘¥]]],1[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[N!2],1[V!ğ‘¥]],2[N!2]]]]	[0.8376963350785339,0.8,0.8421052631578947]
R	11535509	0	[U!eq,0[U!times,0[V!ğ‘“],1[V!ğ‘¥]],1[O!divide,0[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[N!14],1[V!ğ‘¥]],2[N!9]],1[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[N!2],1[V!ğ‘¥]],2[N!3]]]]	[0.8376963350785339,0.7619047619047619,0.8421052631578947]
R	18854663	0	[U!eq,0[U!times,0[V!ğ‘“],1[V!ğ‘¥]],1[O!divide,0[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[V!ğ‘],1[V!ğ‘¥]],2[V!ğ‘]],1[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[N!2],1[V!ğ‘¥]],2[N!3]]]]	[0.8376963350785339,0.7619047619047619,0.8421052631578947]
R	3726843	0	[U!eq,0[U!times,0[V!ğ‘“],1[V!ğ‘¥]],1[O!divide,0[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[V!ğ‘],1[V!ğ‘¥]],2[V!ğ‘]],1[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[N!2],1[V!ğ‘¥]],2[N!3]]]]	[0.8376963350785339,0.7619047619047619,0.8421052631578947]
R	20014085	0	[U!eq,0[U!times,0[V!ğ‘“],1[V!ğ‘¥]],1[O!divide,0[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[V!ğ‘],1[V!ğ‘¥]],2[V!ğ‘]],1[U!plus,0[O!SUP,0[V!ğ‘¥],1[N!2]],1[U!times,0[N!2],1[V!ğ‘¥]],2[N!3]]]]	[0.8376963350785339,0.7619047619047619,0.8421052631578947]
...
```

</details>

`Q` query id  
`E` the Formula  
`R` a tuple defined as such (DocId, Score, Formula, [post count , expr count , doc count])
## all in one bash script
## running parts individually
run all commands from the tangent-s directory
### indexing
run `python3 ../src/python/index_query/index.py example.cntl`  
this will generate a file in `/db-index` called `database_i_<number>.tsv` depending 
on the database name specified in the .cntl file. the format of this file
is discussed in [index](#index)
### querying
### testing
### example